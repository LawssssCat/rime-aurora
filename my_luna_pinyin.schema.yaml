# luna_pinyin.custom.yaml
#
# 部署位置：
# ~/.config/ibus/rime  (Linux)
# ~/Library/Rime  (Mac OS)
# %APPDATA%\Rime  (Windows)
#
# 於重新部署後生效
#
#
# 注意：本補靪適用於所有朙月拼音系列方案（「朙月拼音」、「朙月拼音·简化字」、「朙月拼音·臺灣正體」、「朙月拼音·語句流」）。
# 只須將本 custom.yaml 的前面名字改爲對應的輸入方案名字然後放入用戶文件夾重新部署即可。如 luna_pinyin_simp.custom.yaml。
# 雙拼用戶請使用 double_pinyin.custom.yaml。
#
#
# 附朙月拼音系列方案與其對應的 id 一覽表：
# 輸入方案	id
# 朙月拼音	luna_pinyin
# 朙月拼音·简化字	luna_pinyin_simp
# 朙月拼音·臺灣正體	luna_pinyin_tw
# 朙月拼音·語句流	luna_pinyin_fluency
#
# 配置含义：
# https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md
#
# 【change log】
# 1. 2022/08/25
#    关键词：emoji_suggestion
#    相关链接：
#      1. https://github.com/LoganJC/rime-setting
#      2. https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md#%E4%BA%94simplifier
#    2022/08/26
#    修復濾鏡失效問題
#    问题描述：https://github.com/rime/home/issues/1127
#    修复方法：使用 https://github.com/rime/rime-emoji 的 /opencc 目录覆盖相关文件
#
# 2. 2022/08/25
#    rq输出日期、sj输出时间
#    参考：
#      https://github.com/LEOYoon-Tsaw/Rime_collections/blob/master/Rime_description.md#%E7%A4%BA%E4%BE%8B-9
#      https://www.zhihu.com/question/268770492/answer/2190114796
#    已知问题：
#      /@next => /+ | https://github.com/rime/home/issues/1116
# 3. 2022/08/27
#    添加 “洋蔥” 方案 https://github.com/oniondelta/Onion_Rime_Files

schema:
  schema_id: my_luna_pinyin
  name: （个人）朙月拼音
  version: "0.24"
  author:
    - 佛振 <chen.sst@gmail.com>
    - 骆言 <lawsssscat@163.com>
    - 『洋蔥』
  description: |
    Rime 預設的拼音輸入方案。
    參考以下作品而創作：
      * CC-CEDICT
      * Android open source project
      * Chewing - 新酷音
      * opencc - 開放中文轉換
      * LoganJC 的方案 - https://github.com/LoganJC/rime-setting
      * “洋蔥” 方案 - https://github.com/oniondelta/Onion_Rime_Files
  dependencies:
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]
  - name: emoji_suggestion
    reset: 1
    states: [ "关 ❌", "开 ✔️" ] # 0为关闭、1为开启
  - name: kemoji_suggestion
    reset: 1
    states: [ "关 (＞﹏＜)", "开 ＼(￣︶￣)／" ] # 0为关闭、1为开启
engine:
  processors: # 一、這批組件處理各類 ●按鍵 消息
    # - lua_processor@select_character_processor # 以词定字
    - ascii_composer #  處理西文模式及中西文切換
    - recognizer     #  與 matcher 搭配，處理符合特定規則的輸入碼，如網址、反查●等
    - key_binder     #  在特定條件下將按鍵綁定到其他按鍵，如重定義逗號、句號爲候選翻頁鍵
    - speller        #  拼寫，字符按鍵，編輯輸入碼,默認只接受小寫拉丁字母作爲輸入碼
    - punctuator     #  句讀，將單個字符按鍵直接映射爲文字符號
    - selector       #  選字，處理數字選字鍵、上、下候選定位、換頁鍵
    - navigator      #  輸入欄內的 光標移動鍵
    - express_editor # ←啟用 (空格鍵 輸入中文)、●(enter 鍵輸入英文)，不啟用 (空格鍵輸入中文)(enter 鍵輸入中文)、回退鍵 等
    # - fluency_editor #  編輯器 流输入（需要两次确认才上屏）
  segmentors: # 二、這批組件識別不同內容類型，將輸入碼分段
    - ascii_segmentor      # ※ 標識_西文段落
    - matcher              # ※ 標識_符合特定規則的段落，如網址、反查等
    - abc_segmentor        # ※ 標識_常規的文字段落
    - punct_segmentor      # ※ 標識_句讀段落
    - fallback_segmentor   # ※ 標識_其他未標識段落
  translators: # 三、這批組件翻譯特定類型的編碼段爲一組候選文字
    # - echo_translator # ※ 沒有其他候選字時，回顯輸入碼〔輸入碼可以Shift+Enter上屛〕
    - lua_translator@time_translator    # 时间
    - punct_translator                  # ※ 轉換標點符號
    - table_translator@custom_phrase    #翻譯_打過的字-優先出●碼表翻譯器，用於倉頡、五筆等基於碼表的輸入方案，此項可加載多個實例，後接@+翻譯器名〔如：cangjie、wubi等〕
    - reverse_lookup_translator         # ※ 反查翻譯器，用另一種編碼方案查碼
    - script_translator                 # ※ 腳本翻譯器，用於拼音、粵拼等等基於音節表的輸入方案●此項可加載多個實例，後接@+翻譯器名〔如：pinyin、jyutping等〕
  filters: # 四、這批組件過濾翻譯的結果
    - simplifier@emoji_suggestion     # emoji表情
    - simplifier@kemoji_suggestion    # 颜表情
    - simplifier                      # ※ 繁簡轉換
    - uniquifier                      # ※ 過濾重複的候選字，有可能來自繁簡轉換

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba
  delimiter: " '"
  algebra: # 【朙月拼音】模糊音定製模板 来源：https://gist.github.com/lotem/2320943
    - erase/^xx$/                      # 第一行保留

    # 模糊音定義
    # 需要哪組就刪去行首的 # 號，單雙向任選
    - derive/^([zcs])h/$1/             # zh, ch, sh => z, c, s
    - derive/^([zcs])([^h])/$1h$2/     # z, c, s => zh, ch, sh

    - derive/^n/l/                     # n => l
    - derive/^l/n/                     # l => n
    - derive/^m/n/                     # m => n
    - derive/^m/l/                     # m => l
    - derive/^l/m/                     # l => m
    - derive/^n/m/                     # n => m

    # 這兩組一般是單向的
    # - derive/^r/l/                     # r => l

    # - derive/^ren/yin/                 # ren => yin, reng => ying
    # - derive/^r/y/                     # r => y

    # 下面 hu <=> f 這組寫法複雜一些，分情況討論
    # - derive/^hu$/fu/                  # hu => fu
    # - derive/^hong$/feng/              # hong => feng
    # - derive/^hu([in])$/fe$1/          # hui => fei, hun => fen
    # - derive/^hu([ao])/f$1/            # hua => fa, ...

    # - derive/^fu$/hu/                  # fu => hu
    # - derive/^feng$/hong/              # feng => hong
    # - derive/^fe([in])$/hu$1/          # fei => hui, fen => hun
    # - derive/^f([ao])/hu$1/            # fa => hua, ...

    # 韻母部份
    # - derive/^([bpmf])eng$/$1ong/      # meng = mong, ...
    - derive/([ei])n$/$1ng/            # en => eng, in => ing
    - derive/([ei])ng$/$1n/            # eng => en, ing => in

    # 樣例足夠了，其他請自己總結……

    # 反模糊音？
    # 誰說方言沒有普通話精確、有模糊音，就能有反模糊音。
    # 示例爲分尖團的中原官話：
    - derive/^ji$/zii/   # 在設計者安排下鳩佔鵲巢，尖音i只好雙寫了
    - derive/^qi$/cii/
    - derive/^xi$/sii/
    - derive/^ji/zi/
    - derive/^qi/ci/
    - derive/^xi/si/
    - derive/^ju/zv/
    - derive/^qu/cv/
    - derive/^xu/sv/
    # 韻母部份，只能從大面上覆蓋
    - derive/^([bpm])o$/$1eh/          # bo => beh, ...
    - derive/(^|[dtnlgkhzcs]h?)e$/$1eh/  # ge => geh, se => sheh, ...
    - derive/^([gkh])uo$/$1ue/         # guo => gue, ...
    - derive/^([gkh])e$/$1uo/          # he => huo, ...
    - derive/([uv])e$/$1o/             # jue => juo, lve => lvo, ...
    - derive/^fei$/fi/                 # fei => fi
    - derive/^wei$/vi/                 # wei => vi
    - derive/^([nl])ei$/$1ui/          # nei => nui, lei => lui
    - derive/^([nlzcs])un$/$1vn/       # lun => lvn, zun => zvn, ... 
    - derive/^([nlzcs])ong$/$1iong/    # long => liong, song => siong, ...
    # 這個辦法雖從拼寫上做出了區分，然而受詞典制約，候選字仍是混的。
    # 只有真正的方音輸入方案纔能做到！但「反模糊音」這個玩法快速而有效！

    # 模糊音定義先於簡拼定義，方可令簡拼支持以上模糊音
    - abbrev/^([a-z]).+$/$1/           # 簡拼（首字母）
    - abbrev/^([zcs]h).+$/$1/          # 簡拼（zh, ch, sh）

    # 以下是一組容錯拼寫，《漢語拼音》方案以前者爲正
    - derive/^([nl])ve$/$1ue/          # nve = nue, lve = lue
    - derive/^([jqxy])u/$1v/           # ju = jv,
    - derive/un$/uen/                  # gun = guen,
    - derive/ui$/uei/                  # gui = guei,
    - derive/iu$/iou/                  # jiu = jiou,

    # 自動糾正一些常見的按鍵錯誤
    - derive/([aeiou])ng$/$1gn/        # dagn => dang 
    - derive/([dtngkhrzcs])o(u|ng)$/$1o/  # zho => zhong|zhou
    - derive/ong$/on/                  # zhonguo => zhong guo
    - derive/ao$/oa/                   # hoa => hao
    - derive/([iu])a(o|ng?)$/a$1$2/    # tain => tian

translator:
  dictionary: luna_pinyin.extended
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue/$1üe/
    - xform/([jqxy])v/$1u/
  ##################
  contextual_suggestions: true # 是否使用語言模型優化輸出結果〔需配合grammar使用〕
  # max_homophones: 7 # 最大同音簇長度〔需配合grammar使用〕
  # translator/max_homographs: 7 # 最大同形簇長度〔需配合grammar使用〕
  ##################
  enable_user_dict: true # 是否開啓用戶詞典〔用戶詞典記錄動態字詞頻、用戶詞〕
  enable_sentence: true # 是否開啓自動造句（關閉碼表輸入法連打。用於屏蔽倉頡、五筆中帶有太極圖章「☯」的連打詞句選項，不可作用於拼音、注音、速成等輸入方案。）
  enable_encoder: true # 是否開啓自動造詞〔僅table_translator有效〕
  # enable_charset_filter: true #是否開啓字符集過濾，是true否false
  encode_commit_history: true # 是否對已上屛詞自動成詞〔僅table_translator有效〕
  enable_completion: true # 提前顯示尚未輸入完整碼的字〔僅table_translator有效〕
  sentence_over_completion: true # 在無全碼對應字而僅有逐鍵提示時也開啓智能組句〔僅table_translator有效〕
  spelling_hints: 7
  comment_format: # 提示碼自定義
    - xform/([nl])v/$1ü/
    # - xform/([nljqxyzcs])v/$1ü/ # 分尖團後 v => ü 的改寫條件也要相應地擴充：

custom_phrase: # 功能：自定义短语 custom_phrase.txt
  dictionary: ""
  user_dict: custom_phrase
  db_class: stabledb
  # enable_completion: false
  # enable_sentence: false
  initial_quality: 1

reverse_lookup: # 功能：五笔反查拼音，以 ` 符号开头
  tag: reverse_lookup
  dictionary: stroke
  prefix: "`"
  suffix: "'"
  tips: 〔筆畫〕
  preedit_format: # 上屛碼自定義
    - xlit/hspnz/一丨丿丶乙/

punctuator:
  import_preset: symbols
  ##########################################################
  # 优化字符输入：自定义快捷符号输入
  symbols:
    "/fx": [↑, ↓, ←, →] # 方向
    "/fs": [½, ‰, ¼, ⅓, ⅔, ¾, ⅒] # 分数
    "/xh": [＊, ×, ✱, ★, ☆, ✩, ✧, ❋, ❊, ❉, ❈, ❅, ✿, ✲] # 雪花
    "/dn": [⌘, ⌥, ⇧, ⌃, ⎋, ⇪, , ⌫, ⌦, ↩︎, ⏎, ↑, ↓, ←, →, ↗, ↖, ↙, ↘, ⇟, ⇞]
    "/dq": [🌍, 🌎, 🌏, 🌐, 🌑, 🌒, 🌓, 🌔, 🌕, 🌖, 🌗, 🌘] # 地球
    "/sg": [🍇, 🍉, 🍌, 🍍, 🍎, 🍏, 🍑, 🍒, 🍓, 🍗, 🍦, 🎂, 🍺, 🍻] # 水果
    "/dw": [🙈️, 🐵, 🐈, 🐷, 🐨, 🐼, 🐾, 🐔, 🐬, 🐠, 🦋] # 动物
    "/bq": [😎, 😍, 😋, 😘, 😗, 😉, 😊, 😆, 😃, 😄, 😀, 😁, 😅, 😂, 😭️, 😱️, 😇️, 🙃️, 🤔️, 😈️, 💊️, 💯️, 💩️] # 表情
    "/ss": [💪, 👈, 👉, 👆, 👇, ✋, 👌, 👍, 👎, ✊, 👊, 👋, 👏, 👐] # 手势
    # 拼音 https://github.com/rime/home/issues/161
    "/py": [ ā, á, ǎ, à, ō, ó, ǒ, ò, ê, ê̄, ế, ê̌, ề, ē, é, ě, è, ī, í, ǐ, ì, ū, ú, ǔ, ù, ü, ǖ, ǘ, ǚ, ǜ, ḿ, m̀, ń, ň, ǹ, ẑ, ĉ, ŝ, ŋ ]
    "/pyd": [ Ā, Á, Ǎ, À, Ō, Ó, Ǒ, Ò, Ê, Ê̄, Ế, Ê̌, Ề, Ē, É, Ě, È, Ī, Í, Ǐ, Ì, Ū, Ú, Ǔ, Ù, Ü, Ǖ, Ǘ, Ǚ, Ǜ, Ḿ, M̀, Ń, Ň, Ǹ, Ẑ, Ĉ, Ŝ, Ŋ ]
  half_shape:
    "#": "#"
    "*": "*"
    "`": "`"
    "~": "~"
    "@": "@"
    "=": "="
    "/": ["/", "÷",]
    '\': "、"
    "_" : "──"
    # "'": {pair: ["「", "」"]}
    "[": ["【", "[", "「"]
    "]": ["】", "]", "」"]
    "$": ["¥", "$", "€", "£", "¢", "¤"]
    "<": ["《", "〈", "«", "<"]
    ">": ["》", "〉", "»", ">"]
    '|' : [ '|', ｜, '§', '¦', '‖', ·, ・]
  ##########################################################

key_binder:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    email: "^[A-Za-z][-_.0-9A-Za-z]*@.*$"
    uppercase: "[A-Z][-_+.'0-9A-Za-z]*$"
    url: "^(www[.]|https?:|ftp[.:]|mailto:|file:).*$|^[a-z]+[.].+$"
    html: "^<[a-z]+>$"
    punct: '^/([0-9]0?|[A-Za-z]+)$'
    reverse_lookup: "`[a-z]*'?$"

emoji_suggestion: # 功能：提示emoji，按 F4 选择是否打开
  opencc_config: emoji.json # 位于 %rime_dir%/opencc/ 的字符转换配置文件
  option_name: emoji_suggestion # 对应 switches 中的 name
  tips: all # 字符转换范围

# 问题：颜文字不建议用滤镜（不能用空格）
kemoji_suggestion: # 功能：提示颜表情
  opencc_config: kemoji.json # 位于 %rime_dir%/opencc/ 的字符转换配置文件
  option_name: kemoji_suggestion # 对应 switches 中的 name
  tips: all # 字符转换范围

grammar: # 语法模型
  language: zh-hant-t-essay-bgw